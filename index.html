<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Editor de Cifras Pro</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<style>
/* ----------------------- LOGIN ----------------------- */
@keyframes brilhoBtn {
  from { filter: drop-shadow(0 0 5px #ff3b3b); }
  to { filter: drop-shadow(0 0 20px #ff3b3b); }
}

/* ----------------------- EDITOR ----------------------- */
body{
    font-family:Arial, sans-serif;
    margin:0;
    padding:10px;
    background:#f4f4f4;
}

header{
    background:#222;
    color:white;
    padding:10px;
    border-radius:8px;
}

.botoes-topo button,
.botoes button,
.acoes button{
    padding:8px 12px;
    border:none;
    border-radius:6px;
    cursor:pointer;
}

.botoes-topo button{
    background:#ddd;
    margin:2px;
}

.botoes{
    display:flex;
    flex-wrap:wrap;
    gap:5px;
    margin:10px 0;
}

.botoes button{
    background:#444;
    color:white;
}

.botoes button:hover{
    background:#0080ff;
}

#editor{
    width:100%;
    height:250px;
    border-radius:8px;
    padding:10px;
    font-size:16px;
    background:white;
    overflow:auto;
}

.player{
    margin-top:20px;
    background:#222;
    padding:15px;
    border-radius:10px;
    color:white;
}

.player-controles{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    align-items:center;
    margin-bottom:10px;
}

.player button{
    background:#444;
    color:white;
}

.player button:hover{
    background:#0080ff;
}

#barraProgresso{
    width:100%;
    height:15px;
    cursor:pointer;
}
</style>
</head>

<body>

<!-- ----------------------- TELA DE LOGIN ----------------------- -->
<div id="loginScreen" style="display:flex; justify-content:center; align-items:center; min-height:100vh; background:linear-gradient(135deg,#0f2027,#203a43,#2c5364); font-family:Arial; flex-direction:column;">
  <div style="background:white; padding:40px; border-radius:15px; width:220px; text-align:center; box-shadow:0 10px 30px rgba(0,0,0,0.3);">
    <img src="https://i.imgur.com/kV9yJ0a.jpeg" width="100%" style="border-radius:10px; margin-bottom:20px;" alt="Imagem Login">
    <h2 style="margin-bottom:20px;">üîê √Årea de Login</h2>
    <input type="password" id="senhaInput" placeholder="Digite sua senha" style="padding:12px; width:100%; border-radius:8px; border:1px solid #ccc; outline:none;">
    <br><br>
    <button onclick="verificarSenha()" style="padding:12px; width:100%; border:none; border-radius:8px; background:#28a745; color:white; font-weight:bold; cursor:pointer;">Entrar</button>
    <p id="mensagemErro" style="color:red; display:none; margin-top:10px;">Senha incorreta fale com seu master</p>
    <hr style="margin:30px 0;">
    <button onclick="mostrarPix()" style="background:none; border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px; animation: brilhoBtn 1.5s infinite alternate;">
      <img src="https://img.icons8.com/color/200/pix.png" width="20" alt="Pix">
      <span style="font-size:14px; color:#00ff88; font-weight:bold; text-shadow: 0 0 5px #ff3b3b, 0 0 10px #ff3b3b, 0 0 20px #ff3b3b;">PLANOS - PAGAMENTO</span>
    </button>
    <div id="infoPix" style="display:none; margin-top:20px; background:#f2f2f2; padding:15px; border-radius:10px; font-size:14px;">
      <p><strong>Valor:</strong> R$5.00 - 30 dias / R$40.00 um ano</p>
      <p><strong>Nome:</strong> Isac Coelho Barbosa</p>
      <p><strong>Banco:</strong> Mercado Pago</p>
      <p><strong>Pix:</strong> 84986222876</p>
      <p><strong>Aviso:</strong> Envie o comprovante para o master.</p>
    </div>
    <br>
    <button onclick="abrirWhatsapp()" style="margin-top:15px; padding:12px; width:100%; border:none; border-radius:8px; background:#25D366; color:white; font-weight:bold; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px;">
      <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="20" alt="WhatsApp"> D√∫vidas / Master
    </button>
  </div>
</div>

<!-- ----------------------- CONTAINER DA APLICA√á√ÉO ----------------------- -->
<div id="appContainer" style="display:none;">
<!-- TODO: TODO o conte√∫do do editor de cifras entra aqui -->

<header>
<strong>Nova M√∫sica</strong><br>
Tom:
<select id="seletorTom"></select>
|
Compasso: 4/4
</header>

<div class="botoes-topo">
<button onclick="inserirTexto('Intro.')">Intro</button>
<button onclick="ativarMotivo()">Motivo</button>
<button onclick="inserirTexto('Pr√©-Refr√£o')">Pr√©-Refr√£o</button>
<button onclick="inserirTexto('Refr√£o.')">Refr√£o</button>
<button onclick="inserirTexto('Ponte.')">Ponte</button>
<button onclick="ativarModoGrego()">MG</button>
<button onclick="abrirPainelEstilo()">Tt</button>
<button id="togglePipe" onclick="togglePipe()">Pipe: ON</button>
<button onclick="toggleFiguras()">Figuras</button>
</div>

<div class="botoes" id="botoesNotas"></div>
<div class="botoes" id="botoesFiguras" style="display:none;"></div>

<div class="botoes">
<button onclick="inserirTexto(' % |',true)">%</button>
<button onclick="ativarSlash()">/</button>
<button onclick="inserirTexto('|',true)">|</button>
<button onclick="inserirTexto('¬∞',true)">¬∞</button>
<button onclick="inserirTexto('#',true)">#</button>
<button onclick="inserirTexto('{',true)">{</button>
<button onclick="inserirTexto('}',true)">}</button>
<button onclick="inserirManual()">Obs</button>
</div>

<div id="editor" contenteditable="true"></div>
<div class="botoes" id="botoesDigitos" style="display:none; margin-top:5px;"></div>
<div class="acoes">
<button onclick="salvar()">Salvar</button>
<button onclick="buscar()">Buscar</button>
<button onclick="apagar()">Limpar</button>
<button onclick="salvarPDF()">Salvar em PDF</button>
</div>

<div class="player">
<input type="file" id="audioFile" accept="audio/*">
<audio id="player"></audio>

<div class="player-controles">
<button onclick="voltar5()">‚è™ 5s</button>
<button onclick="playPause()" id="btnPlay">‚ñ∂</button>
<button onclick="avancar5()">5s ‚è©</button>

<select id="velocidade" onchange="mudarVelocidade()">
<option value="0.5">0.5x</option>
<option value="0.75">0.75x</option>
<option value="1" selected>1x</option>
<option value="1.25">1.25x</option>
<option value="1.5">1.5x</option>
</select>

<button onclick="marcarInicioLoop()">A</button>
<button onclick="marcarFimLoop()">B</button>
<button onclick="desativarLoop()">Loop Off</button>

<span id="tempoAtual">0:00</span>
</div>

<input type="range" id="barraProgresso" value="0" min="0" max="100">
</div>

<button id="btnInstall" style="display:none;">üì≤ Instalar App</button>
</div>

<!-- ----------------------- SCRIPTS ----------------------- -->
<script>
// ----------------------- LOGIN -----------------------
const senhasPermitidas = ["VerboVip","0000","1111","2222","3333","4444","5555"];

function verificarSenha() {
  const senha = document.getElementById("senhaInput").value;
  const erro = document.getElementById("mensagemErro");
  if (senhasPermitidas.includes(senha)) {
    erro.style.display = "none";
    document.getElementById("loginScreen").style.display = "none";
    document.getElementById("appContainer").style.display = "block";
    alert("‚úÖ Acesso liberado!");
  } else {
    erro.style.display = "block";
  }
}

function mostrarPix() {
  const pix = document.getElementById("infoPix");
  pix.style.display = pix.style.display === "none" ? "block" : "none";
}

function abrirWhatsapp() {
  window.open("https://api.whatsapp.com/send?phone=5584994625560&text=ol%C3%A1", "_blank");
}

// ----------------------- EDITOR -----------------------
let tomAtual="C";
let pipeAtivo=true;

const escalas = {
    C: ["C","Dm","Em","F","G","Am","B¬∞"],
    Db: ["Db","Ebm","Fm","Gb","Ab","Bbm","C¬∞"],
    D: ["D","Em","F#m","G","A","Bm","C#¬∞"],
    Eb: ["Eb","Fm","Gm","Ab","Bb","Cm","D¬∞"],
    E: ["E","F#m","G#m","A","B","C#m","D#¬∞"],
    F: ["F","Gm","Am","Bb","C","Dm","E¬∞"],
    Gb: ["Gb","Abm","Bbm","Cb","Db","Ebm","F¬∞"],
    G: ["G","Am","Bm","C","D","Em","F#¬∞"],
    Ab: ["Ab","Bbm","Cm","Db","Eb","Fm","G¬∞"],
    A: ["A","Bm","C#m","D","E","F#m","G#¬∞"],
    Bb: ["Bb","Cm","Dm","Eb","F","Gm","A¬∞"],
    B: ["B","C#m","D#m","E","F#","G#m","A#¬∞"]
};

const seletor=document.getElementById("seletorTom");
Object.keys(escalas).forEach(t=>{
    let o=document.createElement("option");
    o.value=t;o.textContent=t;
    seletor.appendChild(o);
});
seletor.value=tomAtual;
seletor.onchange=()=>{tomAtual=seletor.value;gerarBotoes();};

function gerarBotoes(){
    let c=document.getElementById("botoesNotas");
    c.innerHTML="";
    escalas[tomAtual].forEach(a=>{
        let b=document.createElement("button");
        b.textContent=a;
        b.onclick=()=>inserirTexto(a);
        c.appendChild(b);
    });
}
gerarBotoes();

function togglePipe(){
    pipeAtivo=!pipeAtivo;
    document.getElementById("togglePipe").textContent=
    pipeAtivo?"Pipe: ON":"Pipe: OFF";
}

function inserirTexto(t,forcarSemPipe=false){
    const editor=document.getElementById("editor");
    editor.focus();
    let semPipe=["Intro.","Refr√£o.","Pr√©-Refr√£o","Ponte.","Motivo."];
    if(!forcarSemPipe && pipeAtivo && !semPipe.includes(t)){
        t+=" | ";
    }
    document.execCommand("insertText",false,t);
}

function ativarSlash(){
    inserirTexto("/",true);
    let c=document.getElementById("botoesDigitos");
    c.style.display="flex";
    c.innerHTML="";
    ["2","3","5","7"].forEach(d=>{
        let b=document.createElement("button");
        b.textContent=d;
        b.onclick=()=>{
            inserirTexto(d,true);
            c.style.display="none";
        };
        c.appendChild(b);
    });
}

function ativarMotivo(){
    inserirTexto("Motivo.",true);
    let c=document.getElementById("botoesDigitos");
    c.style.display="flex";
    c.innerHTML="";
    ["1","2","3","4","5"].forEach(d=>{
        let b=document.createElement("button");
        b.textContent=d;
        b.onclick=()=>{
            inserirTexto(d,true);
            c.style.display="none";
        };
        c.appendChild(b);
    });
}

function ativarModoGrego(){
    let c=document.getElementById("botoesNotas");
    c.innerHTML="";
    ["I","II","III","IV","V","VI","VII"].forEach(n=>{
        let b=document.createElement("button");
        b.textContent=n;
        b.onclick=()=>inserirTexto(n);
        c.appendChild(b);
    });
}

function abrirPainelEstilo(){
    let opcao = prompt("1-Negrito\n2-It√°lico\n3-Sublinhado\n4-Aumentar\n5-Diminuir\n6-Tamanho Personalizado");
    if(!opcao) return;
    switch(opcao){
        case "1": document.execCommand("bold"); break;
        case "2": document.execCommand("italic"); break;
        case "3": document.execCommand("underline"); break;
        case "4": document.execCommand("fontSize",false,"5"); break;
        case "5": document.execCommand("fontSize",false,"2"); break;
        case "6":
            let tamanho=prompt("Digite o tamanho (ex: 18)");
            if(tamanho){
                document.execCommand("fontSize",false,"7");
                let fonts=document.getElementsByTagName("font");
                for(let i=0;i<fonts.length;i++){
                    if(fonts[i].size=="7"){
                        fonts[i].removeAttribute("size");
                        fonts[i].style.fontSize=tamanho+"px";
                    }
                }
            }
            break;
    }
}

function inserirManual(){
    let t = prompt("Digite observa√ß√£o:");
    if(t){
        const editor = document.getElementById("editor");
        editor.focus();

        // Garante que vamos usar CSS inline
        document.execCommand("styleWithCSS", false, true);

        // Define temporariamente a cor vermelha
        document.execCommand("foreColor", false, "red");

        // Insere o texto digitado
        document.execCommand("insertText", false, t);

        // Volta a cor padr√£o do editor (preto)
        document.execCommand("foreColor", false, "black");
    }
}

const figurasMusicais = [
    {simbolo: "‚ô©", label: "Tempo Cheio"},
    {simbolo: "‚ô´", label: "Duas Colcheias"},
    {simbolo: "‚ô¨", label: "Quatro Semicolcheias"},
    {simbolo: "ùÑê", label: "Fermata"},
    {simbolo: "ùÑæ", label: "Pausa Quarto"},
    {simbolo: "ùÑø", label: "Pausa Oitavo"}
];

function toggleFiguras(){
    const div=document.getElementById("botoesFiguras");
    if(div.style.display==="none"){
        div.style.display="flex";
        div.innerHTML="";
        figurasMusicais.forEach(f=>{
            const btn=document.createElement("button");
            btn.textContent=f.simbolo;
            btn.title=f.label;
            btn.onclick=()=>inserirTexto(f.simbolo,true);
            div.appendChild(btn);
        });
    }else{
        div.style.display="none";
        div.innerHTML="";
    }
}

function salvarPDF(){
    let conteudo=document.getElementById("editor").innerHTML;
    let w=window.open("","","width=800,height=600");
    w.document.write("<html><head><title>Cifra</title></head><body>"+conteudo+"</body></html>");
    w.document.close();
    w.print();
}

function salvar() {
    const conteudo = document.getElementById("editor").innerHTML;
    localStorage.setItem("minhaCifra", conteudo);
    alert("Cifra salva!");
}

function buscar() {
    const conteudo = localStorage.getItem("minhaCifra");
    if(conteudo){
        document.getElementById("editor").innerHTML = conteudo;
        alert("Cifra carregada!");
    } else {
        alert("Nenhuma cifra salva encontrada.");
    }
}

function apagar() {
    if(confirm("Deseja realmente limpar o editor?")){
        document.getElementById("editor").innerHTML = "";
    }
}

// ----------------------- PLAYER -----------------------
const audioFile = document.getElementById("audioFile");
const player = document.getElementById("player");
const barraProgresso = document.getElementById("barraProgresso");
const btnPlay = document.getElementById("btnPlay");
let loopStart = 0;
let loopEnd = null;

audioFile.addEventListener("change", function() {
    const file = this.files[0];
    if(file){
        const url = URL.createObjectURL(file);
        player.src = url;
        player.load();
    }
});

function playPause(){
    if(player.src === "") return;
    if(player.paused){
        player.play();
        btnPlay.textContent = "‚è∏";
    } else {
        player.pause();
        btnPlay.textContent = "‚ñ∂";
    }
}

function voltar5(){ if(player.src === "") return; player.currentTime = Math.max(0, player.currentTime - 5);}
function avancar5(){ if(player.src === "") return; player.currentTime = Math.min(player.duration, player.currentTime + 5);}
function mudarVelocidade(){ player.playbackRate = parseFloat(document.getElementById("velocidade").value); }

player.addEventListener("timeupdate", () => {
    if(player.duration){
        barraProgresso.value = (player.currentTime / player.duration) * 100;
        document.getElementById("tempoAtual").textContent = formatTime(player.currentTime);    }
});

barraProgresso.addEventListener("input", () => {
    if(player.duration){
        player.currentTime = (barraProgresso.value / 100) * player.duration;
    }
});

// Loop
function marcarInicioLoop(){ loopStart = player.currentTime; }
function marcarFimLoop(){ loopEnd = player.currentTime; }
function desativarLoop(){ loopStart = 0; loopEnd = null; }

player.addEventListener("timeupdate", () => {
    if(loopEnd !== null && player.currentTime >= loopEnd){
        player.currentTime = loopStart;
        player.play();
    }
});

// Formatar tempo
function formatTime(t){
    const min = Math.floor(t/60);
    const sec = Math.floor(t%60);
    return `${min}:${sec.toString().padStart(2,"0")}`;
}

// ----------------------- INSTALL PWA -----------------------
let deferredPrompt;
const btnInstall = document.getElementById("btnInstall");

window.addEventListener("beforeinstallprompt", (e) => {
  e.preventDefault();
  deferredPrompt = e;
  btnInstall.style.display = "block";
});

btnInstall.addEventListener("click", async () => {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    console.log("Resultado da instala√ß√£o:", outcome);
    deferredPrompt = null;
    btnInstall.style.display = "none";
  }
});

// Registrar o Service Worker
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
